# Chapter 11 노드 서비스 테스트

## jset
페이스북에서 만든 오픈소스로 테스팅에 필요한 툴을 대부분 갖추고 있다.

## 테스트를 해야하는 이유.

* 기능이 많다면 수작업으로 테스트를하기 힘듦
* 프로그램이 프로그램을 테스트할 수 있도록 자동화함
* 테스트 환경을 최대한 실제 환경과 비슷하게 흉내냄
* 아무리 철저하게 테스트해도 에러를 완전히 막을 수는 없음

## 테스트의 장점

* 한번 발생한 에러는 테스트로 만들어두면 같은 에러가 발생하지 않게 막을 수 있음

---

## 유닛(단위)테스트
작은 단위의 함수나 모듈이 의도된 대로 정확히 작동하는지 테스트 하는 것

* 데이터는 가짜로 만들어서 넣어줘도 된다.(모킹)
* 라우터와 연결된 미들웨어는 분리하여 테스트를 진행한다.
* 데이터베이스와 연결되어있는 미들웨어는 연결되어있는 모델을 모킹하여 진행해야 된다. *jest.mock*
* mokeReturnValue()를 통해 데이터베이스 관련 데이터를 만들어 낼 수 있다.

추가적으로 테스트 해보기!!!
* user라우터 컨트롤러 분리 후 미들웨어 3개 테스트 완료..

---

## 테스트 커버리지

전체 코드중 테스트가 되고있는지 안되고 있는지의 비율을 알려주는 jest의 기능(coverage)을 사용한다.

    ```
    File             | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
    -----------------|---------|----------|---------|---------|-------------------
    All files        |   91.11 |      100 |   71.43 |   91.11 |                   
    controllers     |     100 |      100 |     100 |     100 |                   
    user.js        |     100 |      100 |     100 |     100 |                   
    models          |   33.33 |      100 |       0 |   33.33 |                   
    user.js        |   33.33 |      100 |       0 |   33.33 | 5-47
    routes          |     100 |      100 |     100 |     100 | 
    middlewares.js |     100 |      100 |     100 |     100 | 
    -----------------|---------|----------|---------|---------|-------------------

    Test Suites: 2 passed, 2 total
    Tests:       12 passed, 12 total
    Snapshots:   0 total
    Time:        2.783 s
    Ran all test suites.
    ```
    
* File: 파일과 폴더 이름
* Stmts: 구문 비율
* Branch: if문 등의 분기점 비율
* Funcs: 함수 비율
* Lines: 코드 줄 수 비율
* Uncovered: 커버되지 않은 줄 위치 

하지만 커버리지 기능은 프로젝트 전체의 코드의 커버 비율을 보여주는 것이 아닌 명시적으로 테스트하고 require한 코드만 분석을 한다. 따라서 테스트 커버리지가 100%라고 하더라도 실제 모든 코드를 테스트한 것이 아닐 수 있다는 것을 알아야한다.

---

## 통합 테스트

단위테스트 했던 것들을 통합하여 테스트 하는 것

supertest는 요청을 모킹한다..


